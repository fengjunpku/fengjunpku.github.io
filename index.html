<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>熊窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="喵喵熊的小窝">
<meta property="og:type" content="website">
<meta property="og:title" content="熊窝">
<meta property="og:url" content="http://fengjunpku.github.io/index.html">
<meta property="og:site_name" content="熊窝">
<meta property="og:description" content="喵喵熊的小窝">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="熊窝">
<meta name="twitter:description" content="喵喵熊的小窝">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">熊窝</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">miaomiaoxiong.net</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://fengjunpku.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Synergy-Intro" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/02/10/Synergy-Intro/" class="article-date">
  <time datetime="2017-02-10T08:41:15.000Z" itemprop="datePublished">2017-02-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/10/Synergy-Intro/">Synergy_Intro</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>这是一款可以跨平台共享键鼠的软件</p>
<h2 id="Bug"><a href="#Bug" class="headerlink" title="Bug"></a>Bug</h2><ol>
<li>windows下作为server无法被clien链接：<br>将synergys.exe也要加入防火墙的允许通过列表。</li>
</ol>
<p><a href="http://superuser.com/questions/272365/synergy-windows-7-connection-timed-out" target="_blank" rel="external">参见</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fengjunpku.github.io/2017/02/10/Synergy-Intro/" data-id="ciyzkjrrh0003hwvp6omouy44" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/software/">software</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pyenv" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/04/pyenv/" class="article-date">
  <time datetime="2016-07-04T11:02:18.000Z" itemprop="datePublished">2016-07-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/04/pyenv/">python多环境管理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>可以借助<code>pyenv</code>和<code>virtualenv</code>在单机上搭建多版本<code>python</code>虚拟环境，不搞乱系统自带的python。</p>
<ul>
<li><code>pyenv</code>：可以帮助你在一台开发机上建立多个版本的python环境， 并提供方便的切换方法。</li>
<li><code>virtualenv</code>：提供了一种功能， 就是将一个目录建立为一个虚拟的python环境， 这样的话， 用户可以建立多个虚拟环境， 每个环境里面的python版本可以是不同的， 也可以是相同的， 而且环境之间相互独立。</li>
</ul>
<p>举个例子，首先我们可以用<code>pyenv</code>安装多个<code>python</code>版本， 比如安装了2.6, 2.7, 3.5 三个版本。 用户可以随意切换当前默认的python版本。 但这时候， 每个版本的环境仍是唯一的， 如果我们想在环境中安装一些库的话， 还是会导致这个版本的环境被修改。 这个时候， 如果我们用<code>virtualenv</code>去建立虚拟环境， 就可以完全保证系统路径的干净。无论你在虚拟环境中安装了什么程序， 都不会影响已安装版本的系统环境。</p>
<h2 id="安装pyenv"><a href="#安装pyenv" class="headerlink" title="安装pyenv"></a>安装pyenv</h2><p>参见<a href="https://github.com/yyuu/pyenv" target="_blank" rel="external">pyenv的github页面</a></p>
<h3 id="Mac-OS"><a href="#Mac-OS" class="headerlink" title="Mac OS"></a>Mac OS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">brew update</div><div class="line">brew install pyenv</div></pre></td></tr></table></figure>
<p>然后<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew info pyenv</div></pre></td></tr></table></figure></p>
<p>按照说明配置，即指明pyenv位置，并提供自动补全<br><code>pyenv</code>的默认目录在<code>~/.pyenv</code></p>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p><code>pyenv install --list</code> 查看可安装的<code>python</code>版本<br><code>pyenv install &lt;version&gt;</code> 安装某个版本<br><code>pyenv versions</code> 查看本机所有版本，<code>system</code>为系统python版本，<code>*</code>前缀为激活版本<br><code>pyenv global &lt;version&gt;</code> 切换到某个已安装版本<br><code>pyenv uninstall &lt;version&gt;</code> 删除某个版本</p>
<h2 id="配合virtualenv"><a href="#配合virtualenv" class="headerlink" title="配合virtualenv"></a>配合<code>virtualenv</code></h2><p>一般在<code>pyenv</code>中已经集成了<code>virtualenv</code><br><code>pyenv virtualenv &lt;version&gt; &lt;env_name&gt;</code> 创建一个虚拟环境，目录<code>~/.pyenv/versions/</code><br><code>pyenv versions</code> 可以查看<br><code>pyenv activate &lt;env_name&gt;</code> 激活虚拟环境<br><code>pyenv deactive &lt;env_name&gt;</code> 退出虚拟环境</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fengjunpku.github.io/2016/07/04/pyenv/" data-id="ciyzkjrru000hhwvparhrqxze" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Chromebook-install-linux" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/20/Chromebook-install-linux/" class="article-date">
  <time datetime="2016-06-20T11:48:25.000Z" itemprop="datePublished">2016-06-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/20/Chromebook-install-linux/">Chromebook折腾Linux</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前分别试过用<code>crouton</code>方法和<code>chrx</code>方法快速安装过<code>Ubuntu</code>系统，但每次只要很久不使用，系统完全关机后，<code>chromeOS</code>更新就会重置系统。所以这次下定决心要将原生系统完全删除。</p>
<h2 id="材料"><a href="#材料" class="headerlink" title="材料"></a>材料</h2><ul>
<li>Acer C720 32G</li>
<li>galliumos-haswell-1.0.iso</li>
<li>8G U盘2个<h2 id="备份ChromeOS"><a href="#备份ChromeOS" class="headerlink" title="备份ChromeOS"></a>备份ChromeOS</h2>备份工具 <a href="https://chrome.google.com/webstore/detail/chromebook-recovery-utili/jndclpdbaamdhonoechobihbbiimdgai" target="_blank" rel="external">ChromeOS Recovery Utility</a></li>
</ul>
<p>按照指示制作ChromeOS恢复盘，以防万一。</p>
<h2 id="下载制作linux启动盘"><a href="#下载制作linux启动盘" class="headerlink" title="下载制作linux启动盘"></a>下载制作linux启动盘</h2><p><a href="https://galliumos.org/download.html" target="_blank" rel="external">下载页面</a></p>
<p>我的机器(C720)的CPU是<code>Haswell</code>，所以下载<code>haswell</code>版的镜像。</p>
<p><a href="https://wiki.galliumos.org/Hardware_Compatibility" target="_blank" rel="external">硬件兼容性列表</a></p>
<p><a href="https://wiki.galliumos.org/Installing/Creating_Bootable_USB" target="_blank" rel="external">制作镜像</a></p>
<h2 id="开发者模式"><a href="#开发者模式" class="headerlink" title="开发者模式"></a>开发者模式</h2><p>The next step is to reboot your device in developer mode. This is done by holding down the Escape and Refresh button and then tapping the Power button. When the device reboots, you will be greeted by a screen with a warning. Tap CTRL+D to continue on. You now have access to the developer mode and can enable the necessary boot flags. Here’s what you need to do:</p>
<ol>
<li>Press <code>CTRL+Alt+T</code></li>
<li>In the crosh screen, type <code>shell</code> and hit Enter</li>
<li>Enable to necessary flags with the terminal command: <code>sudo crossystem dev_boot_usb=1 dev_boot_legacy=1</code></li>
</ol>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>插入U盘，重启系统，按<code>CRTL+L</code>选择U盘启动，按指示安装</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://github.com/reynhout/chrx" target="_blank" rel="external">chrx</a></li>
<li><a href="https://galliumos.org" target="_blank" rel="external">GalliumOS</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fengjunpku.github.io/2016/06/20/Chromebook-install-linux/" data-id="ciyzkjrr80000hwvpip2xybvr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/chromebook/">chromebook</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-summary-of-scraping-by-python" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/09/summary-of-scraping-by-python/" class="article-date">
  <time datetime="2016-06-09T14:18:39.000Z" itemprop="datePublished">2016-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/09/summary-of-scraping-by-python/">python爬虫总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="页面获取"><a href="#页面获取" class="headerlink" title="页面获取"></a>页面获取</h2><ul>
<li>urllib2</li>
<li>request</li>
<li>qtwebkit</li>
<li>ghost.py</li>
<li>selenium+PhantomJS<h2 id="页面解析"><a href="#页面解析" class="headerlink" title="页面解析"></a>页面解析</h2></li>
<li>bs4</li>
<li>xpath</li>
<li>re 正则表达式<h2 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h2></li>
<li>pdf pdfminer<h2 id="url管理"><a href="#url管理" class="headerlink" title="url管理"></a>url管理</h2></li>
<li>set </li>
<li>dict </li>
<li>hash map</li>
<li>Bloom Filter : <a href="http://billmill.org/bloomfilter-tutorial/" target="_blank" rel="external">简单例子</a><h2 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h2></li>
<li>数据库</li>
<li>缓存 redis</li>
<li>持久 mysql mongoDB<h2 id="并发：多线程-amp-多进程"><a href="#并发：多线程-amp-多进程" class="headerlink" title="并发：多线程&amp;多进程"></a>并发：多线程&amp;多进程</h2></li>
<li>threading</li>
<li>multiprocessing<h2 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h2><h2 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h2></li>
<li>scrapy<h2 id="一些问题"><a href="#一些问题" class="headerlink" title="一些问题"></a>一些问题</h2></li>
<li>安装scrapy前<br><code>yum install libxslt-devel libxml2-devel python-devel libffi-devel</code></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fengjunpku.github.io/2016/06/09/summary-of-scraping-by-python/" data-id="ciyzkjrrw000jhwvpnntrperu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-install-python3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/04/install-python3/" class="article-date">
  <time datetime="2016-06-04T11:38:51.000Z" itemprop="datePublished">2016-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/04/install-python3/">Centos安装python3</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install zlib zlib-devel openssl openssl-devel</div></pre></td></tr></table></figure>
<p><strong>Optional</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install readline-devel sqlite-devel libbz2</div></pre></td></tr></table></figure></p>
<h1 id="下载python3-5源码，编译安装，默认位置（-usr-local-bin）即可"><a href="#下载python3-5源码，编译安装，默认位置（-usr-local-bin）即可" class="headerlink" title="下载python3.5源码，编译安装，默认位置（/usr/local/bin）即可"></a>下载python3.5源码，编译安装，默认位置（<code>/usr/local/bin</code>）即可</h1><p>删除原有python命令到python2的链接，并建立到python3的新链接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo rm /usr/bin/python</div><div class="line">ln -s /usr/local/bin/python3.5 /usr/bin/python</div></pre></td></tr></table></figure></p>
<p>另外，记得更新yum配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /usr/bin/yum</div></pre></td></tr></table></figure></p>
<p>将第一行<code>#!/usr/bin/python</code>修改为<code>#!/usr/bin/python2</code></p>
<h1 id="Install-setuptools"><a href="#Install-setuptools" class="headerlink" title="Install setuptools"></a>Install setuptools</h1><p>pip安装前需要先安装setuptools<br>在python官网搜索并下载setuptools源码<br>解压，进入目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python ez_setup.py</div></pre></td></tr></table></figure></p>
<p>如果安装python3时第一节提到的依赖关系都有就不会报错。否则就检查依赖关系是否装完整，并重新编译安装python3</p>
<h1 id="Install-pip"><a href="#Install-pip" class="headerlink" title="Install pip"></a>Install pip</h1><p>参考<a href="https://pip.pypa.io/en/stable/installing/" target="_blank" rel="external">pip’s installation instructions</a><br>下载<code>get-pip.py</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python get-pip.py</div></pre></td></tr></table></figure></p>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p><a href="https://www.python.org" target="_blank" rel="external">Python官网</a><br><a href="http://stackoverflow.com/questions/6587507/how-to-install-pip-with-python-3" target="_blank" rel="external">sof上的帖子</a></p>
<h2 id="测试：安装Pillow"><a href="#测试：安装Pillow" class="headerlink" title="测试：安装Pillow"></a>测试：安装Pillow</h2><p>依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install libjpeg-devel libpng-devel</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fengjunpku.github.io/2016/06/04/install-python3/" data-id="ciyzkjrrs000dhwvpxbuvif39" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-poem-at-nangjing" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/03/poem-at-nangjing/" class="article-date">
  <time datetime="2016-06-03T12:23:31.000Z" itemprop="datePublished">2016-06-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/03/poem-at-nangjing/">金陵春夜</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>墙外夜半灯如昼，帐里三更意未犹。</p>
<p>才染新枝折谁手，又发桃花沾何袖。</p>
<p>绞肚搜肠强说惆，似语还休却道秋。</p>
<p>乍暖又寒春难逅，往来倏忽人白头。</p>
<p>欲断川流将刀抽，掩涕长叹和羞走。</p>
<p>年前徒识春风面，中心依旧多苦忧。</p>
<p>彤云沉沉天或晓，靛衾层层梦难幽。</p>
<p>不觉春倦碾左右，非花非雾压眉皱。</p>
<p>鸟鸣始知寒露透，霾重未改天光漏。</p>
<p>百代过客匆匆去，逆旅天地不挽留。</p>
<p>花自飘零水自流，一处闲思一处愁。</p>
<p>可怜此情无寄处，才上心头抛后头。</p>
<p>灵台蜃景幸见卿，半是臆揣半杂糅。</p>
<p>相逢何必曾相识，江野飘飘一沙鸥。</p>
<hr>
<p>在南大选修的古代文学时所作</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fengjunpku.github.io/2016/06/03/poem-at-nangjing/" data-id="ciyzkjrrt000fhwvp6o4cl4vd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mood/">mood</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Untitle-20160603" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/03/Untitle-20160603/" class="article-date">
  <time datetime="2016-06-03T12:17:29.000Z" itemprop="datePublished">2016-06-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/03/Untitle-20160603/">无题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>人心多幻变，</p>
<p>不敢言永远。</p>
<p>念念复念念，</p>
<p>终不挂嘴边。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fengjunpku.github.io/2016/06/03/Untitle-20160603/" data-id="ciyzkjrrm0009hwvpkt45qbtx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mood/">mood</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Scrapy-Sample" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/03/Scrapy-Sample/" class="article-date">
  <time datetime="2016-06-03T12:10:01.000Z" itemprop="datePublished">2016-06-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/03/Scrapy-Sample/">Scrapy_Sample</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="CentOS下安装"><a href="#CentOS下安装" class="headerlink" title="CentOS下安装"></a>CentOS下安装</h2><ul>
<li><p>依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install libxslt-devel libxml2-devel python-devel libffi-devel</div></pre></td></tr></table></figure>
</li>
<li><p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install scrapy</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Start-a-project"><a href="#Start-a-project" class="headerlink" title="Start_a_project"></a>Start_a_project</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scrapy startproject &lt;project_name&gt;</div></pre></td></tr></table></figure>
<p>如果项目名为<code>weather</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">scrapy startproject weather</div><div class="line">tree weather #列出目录结构</div></pre></td></tr></table></figure></p>
<p>文件分别是：<br>    <code>scrapy.cfg</code>: 项目的配置文件<br>    <code>weather/</code>: 该项目的python模块。之后将在此加入代码。<br>    <code>weather/items.py</code>: 项目中的item文件.<br>    <code>weather/pipelines.py</code>: 项目中的pipelines文件.<br>    <code>weather/settings.py</code>: 项目的设置文件.<br>    <code>weather/spiders/</code>: 放置spider代码的目录.</p>
<h2 id="Define-Item"><a href="#Define-Item" class="headerlink" title="Define_Item"></a>Define_Item</h2><p>Item 是保存爬取到的数据的容器；其使用方法和python字典类似，并且提供了额外保护机制来避免拼写错误导致的未定义字段错误。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"># -*- coding: utf-8 -*-</div><div class="line"># items.py</div><div class="line"># Define here the models for your scraped items</div><div class="line"># See documentation in:</div><div class="line"># http://doc.scrapy.org/en/latest/topics/items.html</div><div class="line">import scrapy</div><div class="line"> </div><div class="line">class WeatherItem(scrapy.Item):</div><div class="line">    # define the fields for your item here like:</div><div class="line">    # name = scrapy.Field()</div><div class="line">    # demo 1</div><div class="line">    city = scrapy.Field()</div><div class="line">    date = scrapy.Field()</div><div class="line">    dayDesc = scrapy.Field()</div><div class="line">    dayTemp = scrapy.Field()</div><div class="line">    pass</div></pre></td></tr></table></figure></p>
<h2 id="Edit-Spider"><a href="#Edit-Spider" class="headerlink" title="Edit_Spider"></a>Edit_Spider</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Spider是用户编写用于从单个网站(或者一些网站)爬取数据的类。</p>
<p>其包含了一个用于下载的初始URL，如何跟进网页中的链接以及如何分析页面中的内容， 提取生成 item 的方法。</p>
<p>为了创建一个Spider，必须继承 scrapy.Spider 类， 且定义以下三个属性:</p>
<ul>
<li><p><code>name</code>: 用于区别Spider。该名字必须是唯一的，您不可以为不同的Spider设定相同的名字。</p>
</li>
<li><p><code>start_urls</code>: 包含了Spider在启动时进行爬取的url列表。因此，第一个被获取到的页面将是其中之一。后续的URL则从初始的URL获取到的数据中提取。</p>
</li>
<li><p><code>parse()</code> 是spider的一个方法。 被调用时，每个初始URL完成下载后生成的 Response 对象将会作为唯一的参数传递给该函数。 该方法负责解析返回的数据(response data)，提取数据(生成item)以及生成需要进一步处理的URL的 Request 对象。</p>
</li>
</ul>
<h3 id="分析网页"><a href="#分析网页" class="headerlink" title="分析网页"></a>分析网页</h3><p>页面源码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&lt;h4 class=&quot;slider_ct_name&quot; id=&quot;slider_ct_name&quot;&gt;武汉&lt;/h4&gt;</div><div class="line">...</div><div class="line">&lt;div class=&quot;blk_fc_c0_scroll&quot; id=&quot;blk_fc_c0_scroll&quot; style=&quot;width: 1700px;&quot;&gt;</div><div class="line">    &lt;div class=&quot;blk_fc_c0_i&quot;&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_date&quot;&gt;01-28&lt;/p&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_day wt_fc_c0_i_today&quot;&gt;今天&lt;/p&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_icons clearfix&quot;&gt;</div><div class="line">            &lt;img class=&quot;icons0_wt png24&quot; src=&quot;http://www.sinaimg.cn/dy/weather/main/index14/007/icons_42_yl/w_04_27_00.png&quot; alt=&quot;雨夹雪&quot; title=&quot;雨夹雪&quot;&gt;</div><div class="line">            &lt;img class=&quot;icons0_wt png24&quot; src=&quot;http://www.sinaimg.cn/dy/weather/main/index14/007/icons_42_yl/w_04_29_01.png&quot; alt=&quot;中雪&quot; title=&quot;中雪&quot;&gt;</div><div class="line">        &lt;/p&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_times&quot;&gt;</div><div class="line">            &lt;span class=&quot;wt_fc_c0_i_time&quot;&gt;白天&lt;/span&gt;</div><div class="line">            &lt;span class=&quot;wt_fc_c0_i_time&quot;&gt;夜间&lt;/span&gt;</div><div class="line">        &lt;/p&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_temp&quot;&gt;1°C / -2°C&lt;/p&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_tip&quot;&gt;北风 3～4级&lt;/p&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_tip&quot;&gt;无持续风向 小于3级&lt;/p&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;div class=&quot;blk_fc_c0_i&quot;&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_date&quot;&gt;01-29&lt;/p&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_day &quot;&gt;星期四&lt;/p&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_icons clearfix&quot;&gt;</div><div class="line">            &lt;img class=&quot;icons0_wt png24&quot; src=&quot;http://www.sinaimg.cn/dy/weather/main/index14/007/icons_42_yl/w_04_29_00.png&quot; alt=&quot;中雪&quot; title=&quot;中雪&quot;&gt;</div><div class="line">            &lt;img class=&quot;icons0_wt png24&quot; src=&quot;http://www.sinaimg.cn/dy/weather/main/index14/007/icons_42_yl/w_07_25_01.png&quot; alt=&quot;阴&quot; title=&quot;阴&quot;&gt;</div><div class="line">        &lt;/p&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_times&quot;&gt;</div><div class="line">            &lt;span class=&quot;wt_fc_c0_i_time&quot;&gt;白天&lt;/span&gt;</div><div class="line">            &lt;span class=&quot;wt_fc_c0_i_time&quot;&gt;夜间&lt;/span&gt;</div><div class="line">        &lt;/p&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_temp&quot;&gt;1°C / -2°C&lt;/p&gt;</div><div class="line">        &lt;p class=&quot;wt_fc_c0_i_tip&quot;&gt;无持续风向 小于3级&lt;/p&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    ...</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<p>有如下目标：</p>
<ul>
<li>城市名可以通过获取id为slider_ct_name的h4元素获取</li>
<li>日期可以通过获取id为blk_fc_c0_scroll下的class为wt_fc_c0_i_date的p元素获取</li>
<li>天气描述可以通过获取id为blk_fc_c0_scroll下的class为icons0_wt的img元素获取</li>
<li>温度可以通过获取id为blk_fc_c0_scroll下的class为wt_fc_c0_i_temp的p元素获取<h3 id="Spider"><a href="#Spider" class="headerlink" title="Spider"></a>Spider</h3>因此，我们的Spider代码如下，保存在<code>weather/spiders</code>目录下的<code>localweather.py</code> 文件中:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"># -*- coding: utf-8 -*-</div><div class="line">import scrapy</div><div class="line">from weather.items import WeatherItem</div><div class="line"> </div><div class="line"> </div><div class="line">class WeatherSpider(scrapy.Spider):</div><div class="line">    name = &quot;myweather&quot;</div><div class="line">    allowed_domains = [&quot;sina.com.cn&quot;]</div><div class="line">    start_urls = [&apos;http://weather.sina.com.cn&apos;]</div><div class="line"> </div><div class="line">    def parse(self, response):</div><div class="line">        item = WeatherItem()</div><div class="line">        item[&apos;city&apos;] = response.xpath(&apos;//*[@id=&quot;slider_ct_name&quot;]/text()&apos;).extract()</div><div class="line">        tenDay = response.xpath(&apos;//*[@id=&quot;blk_fc_c0_scroll&quot;]&apos;);</div><div class="line">        item[&apos;date&apos;] = tenDay.css(&apos;p.wt_fc_c0_i_date::text&apos;).extract()</div><div class="line">        item[&apos;dayDesc&apos;] = tenDay.css(&apos;img.icons0_wt::attr(title)&apos;).extract()</div><div class="line">        item[&apos;dayTemp&apos;] = tenDay.css(&apos;p.wt_fc_c0_i_temp::text&apos;).extract()</div><div class="line">        return item</div></pre></td></tr></table></figure>
</li>
</ul>
<p>代码中的xpath和css后面括号的内容为选择器，关于xpath和css选择器的内容可参考<a href="http://doc.scrapy.org/en/0.24/topics/selectors.html" target="_blank" rel="external">官方教程</a></p>
<h3 id="递归爬取"><a href="#递归爬取" class="headerlink" title="递归爬取"></a>递归爬取</h3><p>将<code>spider</code>类写成<code>request</code>的生成器，比如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class spider(scrapy.Spider):</div><div class="line">    ...</div><div class="line">    yield self.make_requests_from_url(url)</div><div class="line">    yield item</div></pre></td></tr></table></figure></p>
<h2 id="Run-Spider"><a href="#Run-Spider" class="headerlink" title="Run_Spider"></a>Run_Spider</h2><p>在项目的scrapy.cfg文件同级目录运行命令，下同）中运行下面的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#运行名字为 myweather 的爬虫，然后把结果以json格式保存在wea.json文件中(数据是以unicode方式编码的)</div><div class="line">scrapy crawl myweather -o wea.json</div></pre></td></tr></table></figure></p>
<h2 id="Save-Data"><a href="#Save-Data" class="headerlink" title="Save_Data"></a>Save_Data</h2><h3 id="Edit-pipeline"><a href="#Edit-pipeline" class="headerlink" title="Edit_pipeline"></a>Edit_pipeline</h3><p>上面只是把数据保存在json文件中了，如果我们想自己保存在文件或数据库中，如何操作呢？</p>
<p>这里就要用到 Item Pipeline 了，那么 Item Pipeline 是什么呢？</p>
<p>当Item在Spider中被收集之后，它将会被传递到Item Pipeline中，一些组件会按照一定的顺序执行对Item的处理。</p>
<p>每个item pipeline组件(有时称之为“Item Pipeline”)是实现了简单方法的Python类。他们接收到Item并通过它执行一些行为，同时也决定此Item是否继续通过pipeline，或是被丢弃而不再进行处理。</p>
<p>item pipeline的典型应用有：</p>
<ul>
<li>清理HTML数据</li>
<li>验证爬取的数据(检查item包含某些字段)</li>
<li>查重(并丢弃)</li>
<li>将爬取结果保存到文件或数据库中</li>
<li>每个item pipeline组件都需要调用 process_item 方法，这个方法必须返回一个 Item (或任何继承类)对象， 或是抛出 DropItem异常，被丢弃的item将不会被之后的pipeline组件所处理。</li>
</ul>
<p>我们这里把数据转码后保存在<code>wea.txt</code>文本中。</p>
<p><code>pipelines.py</code>文件在创建项目时已经自动被创建好了，我们在其中加上保存到文件的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"># -*- coding: utf-8 -*-</div><div class="line"> </div><div class="line"># Define your item pipelines here</div><div class="line">#</div><div class="line"># Don&apos;t forget to add your pipeline to the ITEM_PIPELINES setting</div><div class="line"># See: http://doc.scrapy.org/en/latest/topics/item-pipeline.html</div><div class="line"> </div><div class="line"> </div><div class="line">class WeatherPipeline(object):</div><div class="line">    def __init__(self):</div><div class="line">        pass</div><div class="line"> </div><div class="line">    def process_item(self, item, spider):</div><div class="line">        with open(&apos;wea.txt&apos;, &apos;w+&apos;) as file:</div><div class="line">            city = item[&apos;city&apos;][0].encode(&apos;utf-8&apos;)</div><div class="line">            file.write(&apos;city:&apos; + str(city) + &apos;\n\n&apos;)</div><div class="line"> </div><div class="line">            date = item[&apos;date&apos;]</div><div class="line"> </div><div class="line">            desc = item[&apos;dayDesc&apos;]</div><div class="line">            dayDesc = desc[1::2]</div><div class="line">            nightDesc = desc[0::2]</div><div class="line"> </div><div class="line">            dayTemp = item[&apos;dayTemp&apos;]</div><div class="line"> </div><div class="line">            weaitem = zip(date, dayDesc, nightDesc, dayTemp)</div><div class="line"> </div><div class="line">            for i in range(len(weaitem)):</div><div class="line">                item = weaitem[i]</div><div class="line">                d = item[0]</div><div class="line">                dd = item[1]</div><div class="line">                nd = item[2]</div><div class="line">                ta = item[3].split(&apos;/&apos;)</div><div class="line">                dt = ta[0]</div><div class="line">                nt = ta[1]</div><div class="line">                txt = &apos;date:&#123;0&#125;\t\tday:&#123;1&#125;(&#123;2&#125;)\t\tnight:&#123;3&#125;(&#123;4&#125;)\n\n&apos;.format(</div><div class="line">                    d,</div><div class="line">                    dd.encode(&apos;utf-8&apos;),</div><div class="line">                    dt.encode(&apos;utf-8&apos;),</div><div class="line">                    nd.encode(&apos;utf-8&apos;),</div><div class="line">                    nt.encode(&apos;utf-8&apos;)</div><div class="line">                )</div><div class="line">                file.write(txt)</div><div class="line">        return item</div></pre></td></tr></table></figure></p>
<h3 id="Configure-pipeline"><a href="#Configure-pipeline" class="headerlink" title="Configure_pipeline"></a>Configure_pipeline</h3><p>写好ITEM_PIPELINES后，还有很重要的一步，就是把 ITEM_PIPELINES 添加到设置文件<code>settings.py</code>中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ITEM_PIPELINES = &#123;</div><div class="line">    &apos;weather.pipelines.WeatherPipeline&apos;: 1</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>还可以在设置中修改一下爬虫的 USER_AGENT 和 Referer 信息，增加爬虫请求的时间间隔。整个 settings.py 文件内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"># -*- coding: utf-8 -*-</div><div class="line"> </div><div class="line"># Scrapy settings for weather project</div><div class="line">#</div><div class="line"># For simplicity, this file contains only the most important settings by</div><div class="line"># default. All the other settings are documented here:</div><div class="line">#</div><div class="line">#     http://doc.scrapy.org/en/latest/topics/settings.html</div><div class="line">#</div><div class="line"> </div><div class="line">BOT_NAME = &apos;Googlebot&apos;</div><div class="line"> </div><div class="line">SPIDER_MODULES = [&apos;weather.spiders&apos;]</div><div class="line">NEWSPIDER_MODULE = &apos;weather.spiders&apos;</div><div class="line"> </div><div class="line"># Crawl responsibly by identifying yourself (and your website) on the user-agent</div><div class="line">#USER_AGENT = &apos;weather (+http://www.yourdomain.com)&apos;</div><div class="line">USER_AGENT = &apos;User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36&apos;</div><div class="line"> </div><div class="line">DEFAULT_REQUEST_HEADERS = &#123;</div><div class="line">    &apos;Referer&apos;: &apos;http://www.weibo.com&apos;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">ITEM_PIPELINES = &#123;</div><div class="line">    &apos;weather.pipelines.WeatherPipeline&apos;: 1</div><div class="line">&#125;</div><div class="line"> </div><div class="line">DOWNLOAD_DELAY = 0.5</div></pre></td></tr></table></figure></p>
<h2 id="Run-Again"><a href="#Run-Again" class="headerlink" title="Run_Again"></a>Run_Again</h2><p>在项目的scrapy.cfg同级目录下用下面的命令运行爬虫：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scrapy crawl myweather</div></pre></td></tr></table></figure></p>
<h2 id="Parser-with-BeautifulSoup"><a href="#Parser-with-BeautifulSoup" class="headerlink" title="Parser_with_BeautifulSoup"></a>Parser_with_BeautifulSoup</h2><p>改进<code>WeatherSpider</code>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"># -*- coding: utf-8 -*-</div><div class="line"># localweather.py</div><div class="line">import scrapy</div><div class="line">from bs4 import BeautifulSoup</div><div class="line">from weather.items import WeatherItem</div><div class="line"> </div><div class="line"> </div><div class="line">class WeatherSpider(scrapy.Spider):</div><div class="line">    name = &quot;myweather&quot;</div><div class="line">    allowed_domains = [&quot;sina.com.cn&quot;]</div><div class="line">    start_urls = [&apos;http://weather.sina.com.cn&apos;]</div><div class="line"> </div><div class="line">    def parse(self, response):</div><div class="line">        html_doc = response.body</div><div class="line">        #html_doc = html_doc.decode(&apos;utf-8&apos;)</div><div class="line">        soup = BeautifulSoup(html_doc)</div><div class="line">        itemTemp = &#123;&#125;</div><div class="line">        itemTemp[&apos;city&apos;] = soup.find(id=&apos;slider_ct_name&apos;)</div><div class="line">        tenDay = soup.find(id=&apos;blk_fc_c0_scroll&apos;)</div><div class="line">        itemTemp[&apos;date&apos;] = tenDay.findAll(&quot;p&quot;, &#123;&quot;class&quot;: &apos;wt_fc_c0_i_date&apos;&#125;)</div><div class="line">        itemTemp[&apos;dayDesc&apos;] = tenDay.findAll(&quot;img&quot;, &#123;&quot;class&quot;: &apos;icons0_wt&apos;&#125;)</div><div class="line">        itemTemp[&apos;dayTemp&apos;] = tenDay.findAll(&apos;p&apos;, &#123;&quot;class&quot;: &apos;wt_fc_c0_i_temp&apos;&#125;)</div><div class="line">        item = WeatherItem()</div><div class="line">        for att in itemTemp:</div><div class="line">            item[att] = []</div><div class="line">            if att == &apos;city&apos;:</div><div class="line">                item[att] = itemTemp.get(att).text</div><div class="line">                continue</div><div class="line">            for obj in itemTemp.get(att):</div><div class="line">                if att == &apos;dayDesc&apos;:</div><div class="line">                    item[att].append(obj[&apos;title&apos;])</div><div class="line">                else:</div><div class="line">                    item[att].append(obj.text)</div><div class="line">        return item</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fengjunpku.github.io/2016/06/03/Scrapy-Sample/" data-id="ciyzkjrri0004hwvpj8limff2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scrapy/">scrapy</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bloom-filter" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/02/bloom-filter/" class="article-date">
  <time datetime="2016-06-02T07:49:51.000Z" itemprop="datePublished">2016-06-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/02/bloom-filter/">Bloom-Filter</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>布隆过滤器( Bloom filter)这种数据结构可以快速、高效地判断出一个元素是否在集合中。</p>
<p> 这种高效率的代价是：布隆过滤器有可能作出误判，将一个集合外的元素也判定在集合中。</p>
<p>布隆过滤器的基础结构是比特矢量，比如说一个15维的矢量，每个维度可以取值为0或1。</p>
<p>一开始时每个维度均置为0，代表这个过滤器现在是空的。</p>
<p>当有一个元素加入进来时，可以用2个独立的随机数产生器对元素处理（比如hash算法），产生两个信息指纹。</p>
<p>然后用随机数生成器将这两个指纹映射到（0-14）的区间上，得到两个位置。</p>
<p>将矢量中这两个位置的值置为1，即完成了加入操作。</p>
<p>查询时，也是同样，如果一个元素映射的两个位置的值均为1，则元素已经在集合中了；否则在集合外。</p>
<h2 id="误判估计"><a href="#误判估计" class="headerlink" title="误判估计"></a>误判估计</h2><ul>
<li>设：<br>布隆过滤器大小： <code>m</code>比特<br>元素个数：  <code>n</code><br>散列函数个数：<code>k</code></li>
<li>插入一个元素后：<br>任意比特为0的概率：<code>(1-1/m)^k</code></li>
<li>插入<code>n</code>个元素后：<br>任意比特为0的概率：<code>(1-1/m)^nk</code><br>任意比特为1的概率：<code>1-(1-1/m)^nk</code></li>
<li>一个在集合外的元素，若误判：<br>即：<code>k</code>个位置均为1<br>概率为：<code>{1-(1-1/m)^nk}^k~(1-e^(-kn/m))</code><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>Bloom Filter : <a href="http://billmill.org/bloomfilter-tutorial/" target="_blank" rel="external">简单例子</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fengjunpku.github.io/2016/06/02/bloom-filter/" data-id="ciyzkjrrl0008hwvptmsg8apa" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-OpenMP_Intro" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/30/OpenMP_Intro/" class="article-date">
  <time datetime="2016-05-30T14:05:03.000Z" itemprop="datePublished">2016-05-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/30/OpenMP_Intro/">OpenMP入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="初步"><a href="#初步" class="headerlink" title="初步"></a>初步</h1><p>编译flag: <code>-fopenmp</code><br>头文件：<code>#include &quot;omp.h&quot;</code><br>代码中使用标识 ：<code>#pragma omp parallel</code></p>
<hr>
<h1 id="for循环并行化的约束条件"><a href="#for循环并行化的约束条件" class="headerlink" title="for循环并行化的约束条件"></a>for循环并行化的约束条件</h1><p>尽管OpenMP可以方便地对for循环进行并行化，但并不是所有的for循环都可以进行并行化。以下几种情况不能进行并行化：</p>
<ol>
<li>for循环中的循环变量必须是有符号整形。例如，<code>for (unsigned int i = 0; i &lt; 10; ++i){}</code>会编译不通过；</li>
<li>for循环中比较操作符必须是<code>&lt;, &lt;=, &gt;, &gt;=</code>。例如<code>for (int i = 0; i ！= 10; ++i){}</code>会编译不通过；</li>
<li>for循环中的第三个表达式，必须是整数的加减，并且加减的值必须是一个循环不变量。例如<code>for (int i = 0;i != 10;i = i + 1){}</code>会编译不通过；感觉只能<code>++i; i++; --i;</code> 或<code>i--;</code></li>
<li>如果for循环中的比较操作为<code>&lt;</code>或<code>&lt;=</code>，那么循环变量只能增加；反之亦然。例如<code>for (int i = 0; i != 10; --i)</code>会编译不通过；</li>
<li>循环必须是单入口、单出口，也就是说循环内部不允许能够达到循环以外的跳转语句，<code>exit</code>除外。异常的处理也必须在循环体内处理。例如：若循环体内的<code>break</code>或<code>goto</code>会跳转到循环体外，那么会编译不通过。</li>
</ol>
<hr>
<h1 id="redcution工具"><a href="#redcution工具" class="headerlink" title="redcution工具"></a>redcution工具</h1><p><code>#pragma omp parallel for reduction(+:sum)</code><br>reduction虽然很方便，但它只支持一些基本操作，比如<code>+,-,*,&amp;,|,&amp;&amp;,||</code>等。有些情况下，我们既要避免race condition，但涉及到的操作又超出了reduction的能力范围，应该怎么办呢？这就要用到openMP的另一个工具，critical。来看下面的例子，该例中我们求数组a的最大值，将结果保存在max里。</p>
<hr>
<h1 id="critical工具实例"><a href="#critical工具实例" class="headerlink" title="critical工具实例"></a>critical工具实例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">#include &lt;iostream&gt;</div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">  int max = 0;</div><div class="line">  int a[10] = &#123;11,2,33,49,113,20,321,250,689,16&#125;;</div><div class="line">  #pragma omp parallel for</div><div class="line">  for(int i=0;i&lt;10;i++)</div><div class="line">  &#123;</div><div class="line">    int temp = a[i];</div><div class="line">    #pragma omp critical</div><div class="line">    &#123;</div><div class="line">      if(temp &gt; max)</div><div class="line">        max = temp;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  std::cout&lt;&lt;&quot;max: &quot;&lt;&lt;max&lt;&lt;std::endl;</div><div class="line">  return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上例中，for循环还是被自动分成N份来并行执行，但我们用<code>#pragma omp critical</code>将<code>if (temp &gt; max) max = temp</code>括了起来，它的意思是：各个线程还是并行执行for里面的语句，但当你们执行到critical里面时，要注意有没有其他线程正在里面执行，如果有的话，要等其他线程执行完再进去执行。这样就避免了race condition问题，但显而易见，它的执行速度会变低，因为可能存在线程等待的情况。</p>
<hr>
<h1 id="sections工具"><a href="#sections工具" class="headerlink" title="sections工具"></a>sections工具</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#pragma omp parallel sections</div><div class="line">&#123;</div><div class="line">  #pragma omp section</div><div class="line">  &#123;</div><div class="line">    function1();</div><div class="line">  &#125;</div><div class="line">  #pragma omp section</div><div class="line">  &#123;</div><div class="line">    function2();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>parallel sections里面的内容要并行执行，具体分工上，每个线程执行其中的一个section，如果section数大于线程数，那么就等某线程执行完它的section后，再继续执行剩下的section。在时间上，这种方式与人为用vector构造for循环的方式差不多，但无疑该种方式更方便，而且在单核机器上或没有开启openMP的编译器上，该种方式不需任何改动即可正确编译，并按照单核串行方式执行。</p>
<hr>
<h1 id="API示例"><a href="#API示例" class="headerlink" title="API示例"></a>API示例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">// 设置并行线程数 </div><div class="line">_OMPIMP void _OMPAPI omp_set_num_threads(int _Num_threads); </div><div class="line"> </div><div class="line">// 获取当前并行线程数 </div><div class="line">_OMPIMP int  _OMPAPI omp_get_num_threads(void); </div><div class="line"> </div><div class="line">// 获取当前系统最大可并行运行的线程数 </div><div class="line">_OMPIMP int  _OMPAPI omp_get_max_threads(void); </div><div class="line"> </div><div class="line">// 获取当前运行线程的ID，注意和操作系统中的线程ID不同 </div><div class="line">_OMPIMP int  _OMPAPI omp_get_thread_num(void); </div><div class="line"> </div><div class="line">// 获取当前系统中处理器数目 </div><div class="line">_OMPIMP int  _OMPAPI omp_get_num_procs(void); </div><div class="line"> </div><div class="line">_OMPIMP void _OMPAPI omp_set_dynamic(int _Dynamic_threads); </div><div class="line"> </div><div class="line">_OMPIMP int  _OMPAPI omp_get_dynamic(void); </div><div class="line"> </div><div class="line">_OMPIMP int  _OMPAPI omp_in_parallel(void); </div><div class="line"> </div><div class="line">_OMPIMP void _OMPAPI omp_set_nested(int _Nested); </div><div class="line"> </div><div class="line">_OMPIMP int  _OMPAPI omp_get_nested(void); </div><div class="line"> </div><div class="line">_OMPIMP void _OMPAPI omp_init_lock(omp_lock_t * _Lock); </div><div class="line"> </div><div class="line">_OMPIMP void _OMPAPI omp_destroy_lock(omp_lock_t * _Lock); </div><div class="line"> </div><div class="line">_OMPIMP void _OMPAPI omp_set_lock(omp_lock_t * _Lock); </div><div class="line"> </div><div class="line">_OMPIMP void _OMPAPI omp_unset_lock(omp_lock_t * _Lock); </div><div class="line"> </div><div class="line">_OMPIMP int  _OMPAPI omp_test_lock(omp_lock_t * _Lock); </div><div class="line"> </div><div class="line">_OMPIMP void _OMPAPI omp_init_nest_lock(omp_nest_lock_t * _Lock); </div><div class="line"> </div><div class="line">_OMPIMP void _OMPAPI omp_destroy_nest_lock(omp_nest_lock_t * _Lock); </div><div class="line"> </div><div class="line">_OMPIMP void _OMPAPI omp_set_nest_lock(omp_nest_lock_t * _Lock); </div><div class="line"> </div><div class="line">_OMPIMP void _OMPAPI omp_unset_nest_lock(omp_nest_lock_t * _Lock); </div><div class="line"> </div><div class="line">_OMPIMP int  _OMPAPI omp_test_nest_lock(omp_nest_lock_t * _Lock); </div><div class="line"> </div><div class="line">_OMPIMP double _OMPAPI omp_get_wtime(void); </div><div class="line"> </div><div class="line">_OMPIMP double _OMPAPI omp_get_wtick(void);</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fengjunpku.github.io/2016/05/30/OpenMP_Intro/" data-id="ciyzkjrrj0006hwvpujqzyh8y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/">c++</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/c/" style="font-size: 10px;">c++</a> <a href="/tags/chromebook/" style="font-size: 10px;">chromebook</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/mood/" style="font-size: 15px;">mood</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/scrapy/" style="font-size: 10px;">scrapy</a> <a href="/tags/software/" style="font-size: 10px;">software</a> <a href="/tags/web/" style="font-size: 10px;">web</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/02/10/Synergy-Intro/">Synergy_Intro</a>
          </li>
        
          <li>
            <a href="/2016/07/04/pyenv/">python多环境管理</a>
          </li>
        
          <li>
            <a href="/2016/06/20/Chromebook-install-linux/">Chromebook折腾Linux</a>
          </li>
        
          <li>
            <a href="/2016/06/09/summary-of-scraping-by-python/">python爬虫总结</a>
          </li>
        
          <li>
            <a href="/2016/06/04/install-python3/">Centos安装python3</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Miaomiaoxiong<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>